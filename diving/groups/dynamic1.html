<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="/pro-ldap.css" type="text/css">
<title>Работа с группами в OpenLDAP</title>
<script src="/pro-ldap.js"></script>
</head>
<body>
<p class="nav"><a href="../index.html">Погружение в OpenLDAP</a> > <a href="index.html">Работа с группами в OpenLDAP</a> > Динамические группы: принципы построения. Сравнение наложений dynlist и autogroup</p>
<h1>Динамические группы: принципы построения. Сравнение наложений dynlist и autogroup</h1>
<h3>Содержание</h3>
<div class="contents">
<ul>
<li><a href="#design_concept">Принципы построения динамических списков и групп</a></li>
<li><a href="#comparison">Сравнение наложений dynlist и autogroup</a></li>
<li><a href="#dyngroup_schema">О наборе схемы данных dyngroup</a></li>
<li><a href="#examples">Примеры использования наложений dynlist и autogroup</a></li>
</ul>
</div>

<h2 id="design_concept">Принципы построения динамических списков и групп</h2>
<p>Кроме статических списков и групп, OpenLDAP также может работать и с динамическими. Их поддержка реализована с помощью стандартного наложения <code>dynlist</code>.</p>

<p>Суть записей динамических списков и групп заключается в том, что часть их содержимого (атрибутов и их значений) не хранится в каталоге постоянно (статично), а формируется лишь в тот момент, когда такая запись возвращается пользователю в ответ на его поисковый запрос. Динамическое содержимое таких записей строится на основании текущего состояния каталога на момент запроса записи пользователем, то есть если пользователь дважды запросил одну и ту же динамическую запись, а между этими запросами в каталог были внесены изменения, то динамическое содержимое запрашиваемой записи может оказаться различным.</p>

<p>Само динамическое содержимое записи строится на основании дополнительного поискового запроса в тот же самый каталог. Те атрибуты и их значения, которые будут получены в результате этого дополнительного запроса, будут подставлены в запись динамической группы или списка перед выдачей её пользователю (составят её динамическое содержимое).</p>

<p>Параметры такого дополнительного поискового запроса задаются в виде LDAP URI в одном из атрибутов записи динамической группы. Формат LDAP URI определён в <a href="//pro-ldap.ru/tr/rfc/rfc4516.html">RFC 4516</a>, и тому, кто немного разбирается в параметрах поисковых запросов LDAP, составить такой URI не составит труда. Чтобы не быть голословными, мы разберём компоненты LDAP URI в <a href="dynamic2.1.html#step3">одном из последующих примеров</a>.</p>

<p>Наложение <code>dynlist</code>&thinsp;&mdash;&thinsp;штатное наложение OpenLDAP с хорошо отлаженным функционалом и довольно богатыми возможностями настройки. Оно позволяет учесть практически все возможные нюансы построения динамического содержимого, включая переопределение типов атрибутов и возможности обхода ограничений доступа к каталогу. Но при всём этом, у получающихся в результате работы наложения динамических групп есть один существенный недостаток, как всегда, являющийся обратной стороной их достоинств: динамическое содержимое не рассматривается при оценке поисковых фильтров. Попросту говоря, критерии первоначального поискового запроса оцениваются ещё до того, как записи каталога наполняются динамическим содержимым. Поэтому, если кто-то пытается отобрать только динамические группы, содержащие определённые члены, то ничего не выйдет: на момент оценки фильтров никаких членов в этих группах попросту нет.</p>

<p>Как ни крути, именно возможность фильтрации записей при поиске делает LDAP таким привлекательным для системных администраторов. И в поставке OpenLDAP есть неофициальное наложение <code>autogroup</code>, позволяющее схожим по настройкам с <code>dynlist</code> образом автоматически поддерживать членство записей каталога в группах. Функционал наложения <code>autogroup</code> напоминает функционал другого наложения&thinsp;&mdash;&thinsp;<a href="static2.html">memberof</a>, только наоборот: в записи групп вносятся изменения, если претерпели определённые изменения записи-члены этих групп. То есть, если у записи-члена был убран признак принадлежности к определённой группе, то атрибут его членства будет удалён из этой группы. Если же запись в каталоге приобрела признак членства в какой-то группе, то в запись-группу будет добавлен соответствующий атрибут членства. При этом получающиеся группы уже нельзя назвать динамическими: их атрибуты членства статически находятся в каталоге, только ведутся автоматическим образом. Поэтому частенько среди администраторов такие группы называют "автогруппами" (в конце концов, это следует из названия самого наложения).</p>

<p>Поскольку на момент выполнения первоначального поиска в автогруппах статически прописаны атрибуты членства в них, то можно полноценно использовать фильтрацию по значениям этих атрибутов, что существенно для настройки многих работающих с каталогом приложений.</p>

<p>С точки зрения способа настройки, функционал наложения <code>autogroup</code> похож на <code>dynlist</code> (хотя, конечно, не столь богат, всё-таки наложение неофициальное). Поэтому мы сочли возможным рассмотреть динамические группы (и списки) и автогруппы в одном разделе.</p>

<h2 id="comparison">Сравнение наложений dynlist и autogroup</h2>
<p>Прежде чем рассматривать конкретные примеры настройки, сравним возможности наложений <code>dynlist</code> и <code>autogroup</code>, чтобы можно было сделать обоснованный выбор, какое из них использовать для решения той или иной задачи при работе с каталогом.</p>

<div class="pltab"><table>
<tr><th>Функционал</th><th>dynlist</th><th>autogroup</th></tr>
<tr><td>Природа атрибутов членства в группе (атрибутов-пунктов списка)</td><td>Динамические</td><td>Статические, ведутся автоматически</td></tr>
<tr><td>Возможность применения поисковых фильтров для отбора записей на основе значений атрибутов членства (атрибутов-пунктов)</td><td>Нет</td><td>Да</td></tr>
<tr><td>Поддержка записей-групп</td><td>Да</td><td>Да</td></tr>
<tr><td>Поддержка записей-списков</td><td>Да</td><td>Нет</td></tr>
<tr><td>Возможность переопределения исходного типа атрибута при построении списка</td><td>Да</td><td>Нет</td></tr>
<tr><td>Возможность переопределения авторизационной сущности при выполнении дополнительного поискового запроса</td><td>Да</td><td>Нет</td></tr>
<tr><td>Возможность наложения дополнительных ограничений на отбор записей-кандидатов в члены группы (пункты списка)</td><td>Да</td><td>Нет</td></tr>
<tr><td>Встроенный функционал поддержания признака обратного членства в группе в записях-членах</td><td>Нет</td><td>Да</td></tr>
</table></div>

<p>Следует отметить ещё одну небольшую тонкость, связанную с динамической и статической природой атрибутов, поддерживаемых с помощью этих наложений. При использовании наложения <code>dynlist</code> дополнительная нагрузка на каталог создаётся при выполнении поисковых запросов (в виде вторичных поисковых запросов и обработки их результатов для каждой обслуживаемой записи с динамическим содержимым). Во время модификации записей каталога никакой дополнительной обработки не происходит. При использовании наложения <code>autogroup</code> ситуация обратная: поисковые запросы обрабатываются стандартным способом, а вся дополнительная нагрузка (вторичные поисковые запросы и, при необходимости, модификация записей-групп) происходит именно во время модификации потенциальных записей-членов групп в каталоге. И в том и в другом случае дополнительная нагрузка не будет слишком ощутимой, если, конечно, в каталоге не поддерживаются тысячи динамических или автогрупп.</p>

<h2 id="dyngroup_schema">О наборе схемы данных dyngroup</h2>
<p>Во многих примерах настройки динамических групп, в том числе и в официальной <a href="//pro-ldap.ru/tr/man/slapo-dynlist.5.html">man-странице наложения dynlist</a>, для построения динамических записей используется объектный класс <code>groupOfURLs</code>, в один из атрибутов которого,&thinsp;&mdash;&thinsp;<code>memberURL</code>,&thinsp;&mdash;&thinsp;помещается LDAP URI для описания параметров вторичного поиска потенциальных записей-членов группы (списка). Определения этого объектного класса и типа атрибута входят в <a href="dynamic2.1.html#dyngroup_schema">набор схемы данных dyngroup</a>, включённого в стандартную поставку OpenLDAP. Хотя использование этого объектного класса и типа атрибута является общепринятой практикой, для работы рассматриваемых наложений они не требуются, поскольку, как мы покажем на примерах, динамические группы и списки можно строить и с другими классами и атрибутами. Так что вопрос подключения или неподключения набора схемы данных <code>dyngroup</code> оставляется на выбор администратора каталога.</p>

<p>Единственный случай, когда подключение этого набора схемы необходимо&thinsp;&mdash;&thinsp;настройка наложения <code>dynlist</code> с переопределением авторизационной сущности при выполнении вторичного поискового запроса. Наложение ищет в записи динамической группы конкретный атрибут <code>dgIdentity</code>, который, вместе с содержащим его вспомогательным объектным классом <code>dgIdentityAux</code>, входит в тот же набор схемы данных <code>dyngroup</code>.</p>

<h2 id="examples">Примеры использования наложений dynlist и autogroup</h2>
<p>Поскольку вариантов настройки обоих наложений довольно много, рассмотреть их в рамках одного обзора не получится. Поэтому мы решили разобрать работу наложений на примерах. Сначала мы разберём "стандартные" варианты настройки наложений <a href="dynamic2.html">dynlist</a> и <a href="dynamic3.html">autogroup</a> для построения каталогов с динамическим содержимым, а затем&thinsp;&mdash;&thinsp;несколько <a href="mutual1.html">нетривиальных конфигураций</a>, в которых динамические объекты строятся на основе статических групп каталога.</p>

<p class="nav"><a href="../index.html">Погружение в OpenLDAP</a> > <a href="index.html">Работа с группами в OpenLDAP</a> > Динамические группы: принципы построения. Сравнение наложений dynlist и autogroup</p>
<div class="about"><a href="//pro-ldap.ru">Pro-LDAP.ru</a> 2013-2019 г. Последнее изменение страницы&thinsp;&mdash;&thinsp;28 декабря 2018 г. Вопросы и предложения принимаются на <a href="//pro-ldap.ru/forum/index.php?topic=41.0">форуме проекта</a>.</div>
</body></html>
